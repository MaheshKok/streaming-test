<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>AI Assistant ðŸ¤“</title>
    <meta name="viewport" content="initial-scale=1, width=device-width" />
    <script src="https://unpkg.com/react@17.0.2/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@17.0.2/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@material-ui/core@4.12.4/umd/material-ui.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone@7.14.7/babel.min.js" crossorigin></script>
    <script src="https://cdn.jsdelivr.net/npm/marked@3.0.7/marked.min.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;600;700&display=swap" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />
    <style>
        body { background-color: #121212; color: #ffffff; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const {
            CssBaseline,
            ThemeProvider,
            Typography,
            TextField,
            Container,
            createTheme,
            Box,
            CircularProgress,
        } = MaterialUI;

        const theme = createTheme({
            palette: {
                mode: 'dark',
            },
        });
        const WS = new WebSocket("ws://localhost:8000/ws");

        function App() {
            const [response, setResponse] = React.useState("");
            const [question, setQuestion] = React.useState("");
            const [loading, setLoading] = React.useState(false);

            React.useEffect(() => {
                WS.onmessage = (event) => {
                    setLoading(false);
                    setResponse(marked.parse(event.data));
                };
            }, []);

            return (
                <Container maxWidth="lg">
                    <Box sx={{ my: 4 }}>
                        <Typography variant="h4" component="h1" gutterBottom>
                            AI Assistant ðŸ¤“
                        </Typography>
                        <TextField
                            id="outlined-basic"
                            label="Ask me Anything"
                            variant="outlined"
                            fullWidth
                            value={question}
                            disabled={loading}
                            onChange={(e) => setQuestion(e.target.value)}
                            onKeyUp={(e) => {
                                if (e.key === "Enter" && !loading) {
                                    setResponse('');
                                    setLoading(true);
                                    WS.send(question);
                                }
                            }}
                        />
                    </Box>
                    {loading && (
                        <Box display="flex" justifyContent="center" my={4}>
                            <CircularProgress />
                        </Box>
                    )}
                    {response && (
                        <Typography
                            component="div"
                            dangerouslySetInnerHTML={{ __html: response }}
                        />
                    )}
                </Container>
            );
        }

        ReactDOM.render(
            <ThemeProvider theme={theme}>
                <CssBaseline />
                <App />
            </ThemeProvider>,
            document.getElementById('root')
        );
    </script>
</body>
</html>